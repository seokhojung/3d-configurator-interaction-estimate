# Story 1.2 — Test Infrastructure Setup

Status: Done
Epic: 1 — Template Management
Story: 2

## Dependencies
- Depends on: Story 1.1 — Template Metadata and Basic CRUD API (Status: Done)

## Story
As a developer,
I want a runnable test infrastructure (unit/integration/e2e),
so that I can verify APIs and flows reliably and continuously.

## Acceptance Criteria
1. 리포 루트에 `package.json`이 존재하고 다음 스크립트를 제공한다: `test`, `test:unit`, `test:integration`, `test:watch`, `e2e`.
2. 테스트 스택 선택 및 문서화: Unit/Integration(권장: Vitest), E2E(권장: Playwright). 선택 근거를 `docs/architecture/test-stack.md`에 기록한다.
3. 디렉터리 스켈레톤 준비: `tests/unit/`, `tests/integration/`, `e2e/`가 존재하고 최소 1개 이상 스켈레톤 파일이 있다.
4. 스켈레톤 테스트는 현 상태에서 실패를 유발하지 않도록 `it.todo` 또는 `test.skip` 형태로 작성되어 있다.
5. 의존성 설치 후 `npm run test` 실행 시 프로세스가 정상 종료한다(스킵/토도 허용). CI 통합은 범위 외.
6. PRD “Test Strategy and Standards”와 선택 스택/폴더 구조/실행 방법이 정합성을 가진다.

## Tasks / Subtasks
- [x] 프레임워크 선정 및 기록 (Unit/Integration: Vitest or Jest, E2E: Playwright)
- [x] `package.json` 테스트 스크립트 구성 (`test`, `test:unit`, `test:integration`, `test:watch`, `e2e`)
- [x] 디렉터리 생성: `tests/unit`, `tests/integration`, `e2e`
- [x] 스켈레톤 테스트 추가(201/401/422/404 시나리오 골격) — 현재 리포에는 스켈레톤이 일부 추가됨
- [x] 실행 가이드 문서 추가: `docs/qa/test-run-guide.md` (로컬 실행/의존성 설치/명령어)
- [ ] (옵션) 커버리지 설정 기본값 정의 및 후속 스토리로 분리
- [x] Node 엔진 범위 및 TypeScript 설정(tsconfig, ESM/CJS) 결정 및 반영
 - [x] 테스트 파일 매칭(glob) 규칙 확정 및 러너 설정에 반영

## Dev Notes
- NFR/전략 연계: PRD의 Test Strategy(E2E CRITICAL) 반영 — E2E는 Playwright 기반으로 설정 권장
- 외부 연동: Supabase/Storage 등 외부 서비스와의 실제 통합 테스트는 이후 통합 스토리에서 수행
- CI/CD: 본 스토리 범위에서 제외(후속 스토리 분리)
 - 엔진/버전 권장: `"engines": { "node": ">=18 <=22" }`, 테스트 프레임워크는 주요 버전 범위로 고정(예: Vitest `^1.x`, Playwright `^1.x`)
 - TypeScript: 테스트 파일이 `.ts`이므로 러너에서 TS 지원을 사용. `tsconfig.json`과 ESM/CJS 설정(예: `"type": "module"` 여부)을 명확히 하고, 필요 시 러너 설정에서 `esbuild`/`ts-node` 사용 명시
 - Test file glob 예시(권장): Unit `tests/unit/**/*.spec.ts`, Integration `tests/integration/**/*.int.spec.ts`

## References
- PRD — Test Strategy and Standards: `docs/prd/test-strategy-and-standards.md#test-strategy-and-standards`

## Testing
- Unit: 스키마/유효성/에러 계약(422 등) 단위 검증
- Integration: 인증 분기(401/200), 상세(200/404), 생성(201) 플로우 스모크
- E2E: 추후 Playwright 기반으로 PDF/다운로드/브라우저 호환 시나리오 설계 시작

## File List (Planned/Updated)
package.json
tsconfig.json
tests/unit/templates.spec.ts
tests/integration/templates.int.spec.ts
e2e/smoke.spec.ts
docs/architecture/test-stack.md
docs/qa/test-run-guide.md

## QA Results
게이트 결정: PASS

요약(테스트 인프라 기준선 검증)
- 준비도: 9/10
- 신뢰도: High
- 확인 사항: `package.json` 스크립트, TS 설정, 디렉터리/글롭 규칙, 실행 가이드/스택 문서, 유닛/통합 테스트 실행 기준선

AC 충족 여부
- AC1: 루트 `package.json` 및 스크립트(`test`, `test:unit`, `test:integration`, `test:watch`, `e2e`) — 충족
- AC2: 스택 선택 및 문서화(`docs/architecture/test-stack.md`) — 충족
- AC3: 디렉터리 스켈레톤(`tests/unit`, `tests/integration`, `e2e`) — 충족
- AC4: 스켈레톤 실패 방지(초기 TODO/skip → 현재는 실제 케이스로 전환되었으나 통과) — 충족
- AC5: `npm run test` 정상 종료(유닛+통합 실행, E2E 제외) — 충족
- AC6: PRD 참조 정합성(`docs/prd/test-strategy-and-standards.md#test-strategy-and-standards`) — 충족

리스크/메모
- E2E(Playwright) 브라우저 설치/실행은 후속 스토리에서 다룸(본 스토리 범위 외)
- Node/패키지 메이저 범위는 추적 필요(보안 업데이트 시 영향 검토)

테스트 실행 근거
- `npm run test:unit` — Passed
- `npm run test:integration` — Passed
- `npm run test` — Passed(유닛+통합)

## Dev Agent Record
### Agent Model Used
### Debug Log References
2025-10-28: Added test infra scaffolding without installing deps (network restricted). Created `package.json` with scripts, `tsconfig.json`, `docs/architecture/test-stack.md`, `docs/qa/test-run-guide.md`, `e2e/smoke.spec.ts`. Unit/Integration skeleton already present.
2025-10-28: Network allowed; installed dev deps (`vitest`, `typescript`, `@types/node`). Adjusted unit/integration tests to import vitest globals. Updated `package.json` test script to exclude `e2e` from vitest run. Executed `npm run test:unit`, `npm run test:integration`, `npm run test` — all exit clean with TODO tests.
### Completion Notes List
Partial infra prepared: scripts/globs/docs in place; pending dependency installation and runner execution in a network-enabled environment.
Baseline achieved: AC5(로컬 `npm run test` 정상 종료) 충족. E2E는 별도 스토리에서 Playwright 브라우저 설치 후 진행.
### Change Log
2025-10-28: Dev added test infra scaffolding files and docs (no installs).
2025-10-28: Dev installed deps and validated test scripts (unit/integration) pass baseline.
