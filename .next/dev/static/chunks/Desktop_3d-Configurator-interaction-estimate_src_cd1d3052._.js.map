{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/app/templates/_components/SchemaForm.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useMemo, useRef, useState } from 'react';\n\nexport type FieldType = 'text' | 'checkbox' | 'select';\nexport interface SchemaField {\n  type: FieldType;\n  pdf_field_name: string;\n  label?: string;\n  required?: boolean;\n  options?: string[];\n}\nexport interface SchemaSection {\n  section_id?: string;\n  title?: string;\n  fields: SchemaField[];\n}\nexport interface UISchema {\n  sections: SchemaSection[];\n}\n\nexport interface SchemaFormProps {\n  templateId: string;\n  schema: UISchema;\n  onValuesChange?: (values: Values) => void;\n}\n\ntype Values = Record<string, any>;\ntype Errors = Record<string, string>;\n\nfunction defaultValue(field: SchemaField): any {\n  if (field.type === 'checkbox') return false;\n  return '';\n}\n\nfunction validateField(field: SchemaField, value: any): string | '' {\n  if (field.required) {\n    if (field.type === 'text') {\n      if (typeof value !== 'string' || value.trim() === '') return '필수 항목입니다';\n    } else if (field.type === 'checkbox') {\n      if (typeof value !== 'boolean') return '불리언 값이 필요합니다';\n    } else if (field.type === 'select') {\n      if (!field.options || !Array.isArray(field.options)) return '';\n      if (!field.options.includes(value)) return '유효한 옵션을 선택하세요';\n    }\n  } else {\n    // optional but type check for checkbox/select\n    if (field.type === 'checkbox' && typeof value !== 'boolean') return '불리언 값이 필요합니다';\n    if (field.type === 'select' && value && field.options && !field.options.includes(value)) return '유효한 옵션을 선택하세요';\n  }\n  return '';\n}\n\nexport default function SchemaForm({ templateId, schema, onValuesChange }: SchemaFormProps) {\n  const firstInputRef = useRef<HTMLInputElement | HTMLSelectElement | null>(null);\n  const fieldRefs = useRef<Record<string, HTMLInputElement | HTMLSelectElement | null>>({});\n  const fields = useMemo(() => schema.sections.flatMap((s) => s.fields), [schema]);\n  const [values, setValues] = useState<Values>(() => {\n    const init: Values = {};\n    fields.forEach((f) => (init[f.pdf_field_name] = defaultValue(f)));\n    return init;\n  });\n  const [errors, setErrors] = useState<Errors>({});\n\n  useEffect(() => {\n    // Reset when templateId changes\n    const init: Values = {};\n    fields.forEach((f) => (init[f.pdf_field_name] = defaultValue(f)));\n    setValues(init);\n    setErrors({});\n    // focus first input\n    setTimeout(() => firstInputRef.current?.focus(), 0);\n    if (onValuesChange) onValuesChange(init);\n  }, [templateId, fields]);\n\n  function onChange(field: SchemaField, v: any) {\n    setValues((prev) => {\n      const next = { ...prev, [field.pdf_field_name]: v };\n      if (onValuesChange) onValuesChange(next);\n      return next;\n    });\n    // live validate\n    const msg = validateField(field, v);\n    setErrors((prev) => ({ ...prev, [field.pdf_field_name]: msg }));\n  }\n\n  function onSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    const nextErrors: Errors = {};\n    fields.forEach((f) => {\n      const msg = validateField(f, values[f.pdf_field_name]);\n      if (msg) nextErrors[f.pdf_field_name] = msg;\n    });\n    setErrors(nextErrors);\n    if (Object.keys(nextErrors).length === 0) {\n      // noop for now\n    } else {\n      // focus first invalid field for accessibility\n      for (const f of fields) {\n        if (nextErrors[f.pdf_field_name]) {\n          const el = fieldRefs.current[f.pdf_field_name];\n          if (el && typeof (el as any).focus === 'function') {\n            // schedule after state update flush\n            setTimeout(() => el.focus(), 0);\n          }\n          break;\n        }\n      }\n    }\n  }\n\n  const hasErrors = Object.values(errors).some((m) => m);\n\n  let firstInputAssigned = false;\n\n  return (\n    <form onSubmit={onSubmit} aria-labelledby=\"schema-form-title\">\n      <h1 id=\"schema-form-title\" style={{ fontSize: 18 }}>작성 폼</h1>\n      {schema.sections.map((sec, si) => (\n        <section key={sec.section_id || si} aria-labelledby={`section-${si}-title`}>\n          {sec.title && <h2 id={`section-${si}-title`}>{sec.title}</h2>}\n          <div>\n            {sec.fields.map((f, fi) => {\n              const id = `${f.pdf_field_name}`;\n              const err = errors[f.pdf_field_name] || '';\n              const commonProps: any = {\n                ref: (el: any) => {\n                  fieldRefs.current[f.pdf_field_name] = el;\n                  if (!firstInputAssigned && el) {\n                    firstInputRef.current = el;\n                  }\n                },\n              };\n              if (!firstInputAssigned) firstInputAssigned = true;\n              return (\n                <div key={id} style={{ marginBottom: 12 }}>\n                  <label htmlFor={id}>{f.label || f.pdf_field_name}{f.required ? ' *' : ''}</label>\n                  {f.type === 'text' && (\n                    <input\n                      id={id}\n                      type=\"text\"\n                      value={values[f.pdf_field_name] ?? ''}\n                      onChange={(e) => onChange(f, e.target.value)}\n                      {...commonProps}\n                    />\n                  )}\n                  {f.type === 'checkbox' && (\n                    <input\n                      id={id}\n                      type=\"checkbox\"\n                      checked={Boolean(values[f.pdf_field_name])}\n                      onChange={(e) => onChange(f, e.target.checked)}\n                      {...commonProps}\n                    />\n                  )}\n                  {f.type === 'select' && (\n                    <select\n                      id={id}\n                      value={values[f.pdf_field_name] ?? ''}\n                      onChange={(e) => onChange(f, e.target.value)}\n                      {...commonProps}\n                    >\n                      <option value=\"\">선택...</option>\n                      {(f.options || []).map((opt) => (\n                        <option key={opt} value={opt}>{opt}</option>\n                      ))}\n                    </select>\n                  )}\n                  <div role=\"status\" aria-live=\"polite\" style={{ color: '#d00', minHeight: 16 }}>\n                    {err}\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </section>\n      ))}\n      <button type=\"submit\" aria-disabled={hasErrors}>Next</button>\n    </form>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 280, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/app/templates/_components/PdfPreview.tsx"],"sourcesContent":["\"use client\";\nimport React from 'react';\n\nexport default function PdfPreview({ src }: { src: string }) {\n  return (\n    <section aria-labelledby=\"pdf-preview-title\">\n      <h2 id=\"pdf-preview-title\">PDF Preview</h2>\n      <iframe title=\"PDF Preview\" src={src} style={{ width: '100%', height: 480, border: '1px solid #ccc' }} />\n    </section>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAAA;;AAGe,SAAS,WAAW,EAAE,GAAG,EAAmB;IACzD,qBACE,yPAAC;QAAQ,mBAAgB;;0BACvB,yPAAC;gBAAG,IAAG;0BAAoB;;;;;;0BAC3B,yPAAC;gBAAO,OAAM;gBAAc,KAAK;gBAAK,OAAO;oBAAE,OAAO;oBAAQ,QAAQ;oBAAK,QAAQ;gBAAiB;;;;;;;;;;;;AAG1G;KAPwB","debugId":null}},
    {"offset": {"line": 329, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/lib/templates/validation.ts"],"sourcesContent":["import { CreateTemplateInput, ErrorBody, TemplateType } from './types';\n\nexport const ERROR = {\n  VALIDATION_ERROR: 'VALIDATION_ERROR',\n  STORAGE_PATH_INVALID: 'STORAGE_PATH_INVALID',\n  STORAGE_UNAVAILABLE: 'STORAGE_UNAVAILABLE',\n  UNAUTHORIZED: 'UNAUTHORIZED',\n  NOT_FOUND: 'NOT_FOUND',\n  FORBIDDEN: 'FORBIDDEN',\n} as const;\n\nexport function isTemplateType(v: unknown): v is TemplateType {\n  return v === 'basic' || v === 'advanced';\n}\n\nexport function validateCreateInput(body: CreateTemplateInput): ErrorBody | null {\n  if (!body || typeof body !== 'object') {\n    return { code: ERROR.VALIDATION_ERROR, message: 'Body must be an object' };\n  }\n  const { name, type, storage_path } = body;\n  if (!name || typeof name !== 'string') {\n    return { code: ERROR.VALIDATION_ERROR, message: 'name is required' };\n  }\n  if (!type || typeof type !== 'string' || !isTemplateType(type)) {\n    return { code: ERROR.VALIDATION_ERROR, message: 'type must be basic|advanced' };\n  }\n  if (!storage_path || typeof storage_path !== 'string') {\n    return { code: ERROR.VALIDATION_ERROR, message: 'storage_path is required' };\n  }\n  return null;\n}\n\n// Placeholder storage path existence check.\n// Accepts supabase schema-like pseudo URIs: supabase://templates/...\nexport function storagePathSeemsValid(path: string): boolean {\n  return /^supabase:\\/\\/templates\\/.+/.test(path);\n}\n\n// For PUT (full update) semantics we can reuse create validation\n// to require name/type/storage_path. Version remains optional.\nexport function validateUpdateInput(body: CreateTemplateInput): ErrorBody | null {\n  return validateCreateInput(body);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAEO,MAAM,QAAQ;IACnB,kBAAkB;IAClB,sBAAsB;IACtB,qBAAqB;IACrB,cAAc;IACd,WAAW;IACX,WAAW;AACb;AAEO,SAAS,eAAe,CAAU;IACvC,OAAO,MAAM,WAAW,MAAM;AAChC;AAEO,SAAS,oBAAoB,IAAyB;IAC3D,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;QACrC,OAAO;YAAE,MAAM,MAAM,gBAAgB;YAAE,SAAS;QAAyB;IAC3E;IACA,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,YAAY,EAAE,GAAG;IACrC,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;QACrC,OAAO;YAAE,MAAM,MAAM,gBAAgB;YAAE,SAAS;QAAmB;IACrE;IACA,IAAI,CAAC,QAAQ,OAAO,SAAS,YAAY,CAAC,eAAe,OAAO;QAC9D,OAAO;YAAE,MAAM,MAAM,gBAAgB;YAAE,SAAS;QAA8B;IAChF;IACA,IAAI,CAAC,gBAAgB,OAAO,iBAAiB,UAAU;QACrD,OAAO;YAAE,MAAM,MAAM,gBAAgB;YAAE,SAAS;QAA2B;IAC7E;IACA,OAAO;AACT;AAIO,SAAS,sBAAsB,IAAY;IAChD,OAAO,8BAA8B,IAAI,CAAC;AAC5C;AAIO,SAAS,oBAAoB,IAAyB;IAC3D,OAAO,oBAAoB;AAC7B","debugId":null}},
    {"offset": {"line": 393, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/lib/storage/supabaseClient.ts"],"sourcesContent":["export const STORAGE_ERROR = { STORAGE_UNAVAILABLE: 'STORAGE_UNAVAILABLE' } as const;\n\ntype Ext = 'json' | 'yaml' | 'yml';\n\nconst memoryBucket = new Set<string>();\n\nfunction keyFromPath(path: string): { bucket: string; key: string } | null {\n  const m = /^supabase:\\/\\/([^\\/]+)\\/(.+)$/.exec(path);\n  if (!m) return null;\n  return { bucket: m[1], key: m[2] };\n}\n\nfunction useRealSdk(): boolean {\n  const url = process.env.SUPABASE_URL;\n  const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n  return Boolean(url && serviceKey && process.env.USE_SUPABASE_SDK === '1');\n}\n\nexport function existsStoragePath(\n  path: string\n): { ok: true; exists: boolean } | { ok: false; error: { code: string; message: string } } {\n  try {\n    const parsed = keyFromPath(path);\n    if (!parsed) return { ok: true, exists: false };\n\n    if (useRealSdk()) {\n      // Lazy, bundler-opaque require to avoid build-time resolution errors in Next dev\n      try {\n        // eslint-disable-next-line no-eval\n        const req: any = (0, eval)('require');\n        const { createClient } = req('@supabase/supabase-js');\n        const client = createClient(process.env.SUPABASE_URL as string, process.env.SUPABASE_SERVICE_ROLE_KEY as string);\n        // HEAD via list with prefix limited to exact key; reduce network when possible.\n        // Note: in this environment tests run without SDK; this branch is only used when explicitly enabled.\n        const bucket = client.storage.from(parsed.bucket);\n        const list = bucket.list(parsed.key.replace(/\\/[^/]+$/, ''), { search: parsed.key.split('/').pop() });\n        // Promise-like guard: if list is a promise, handle synchronously unsupported in this wrapper context.\n        if (typeof (list as any)?.then === 'function') {\n          // Not awaited to keep current sync signature; treat as unavailable for now.\n          return { ok: false, error: { code: STORAGE_ERROR.STORAGE_UNAVAILABLE, message: 'Async SDK path check not supported in sync context' } };\n        }\n      } catch (e: any) {\n        // Fallback to stub on missing SDK or runtime errors\n      }\n    }\n\n    const composite = `${parsed.bucket}/${parsed.key}`;\n    return { ok: true, exists: memoryBucket.has(composite) };\n  } catch (e: any) {\n    return { ok: false, error: { code: STORAGE_ERROR.STORAGE_UNAVAILABLE, message: e?.message || 'Storage unavailable' } };\n  }\n}\n\nexport function uploadTemplateContent(params: {\n  uid: string;\n  version: number;\n  ext: Ext;\n  content: string;\n  contentType: string;\n}): { ok: true; storage_path: string } | { ok: false; error: { code: string; message: string } } {\n  try {\n    const bucket = 'templates';\n    const key = `${params.uid}/template-${params.version}.${params.ext}`;\n\n    if (useRealSdk()) {\n      try {\n        // eslint-disable-next-line no-eval\n        const req: any = (0, eval)('require');\n        const { createClient } = req('@supabase/supabase-js');\n        const client = createClient(process.env.SUPABASE_URL as string, process.env.SUPABASE_SERVICE_ROLE_KEY as string);\n        const storage = client.storage.from(bucket);\n        const file = new Blob([params.content], { type: params.contentType || 'application/octet-stream' });\n        const uploadRes = storage.upload(key, file, { upsert: true });\n        if (typeof (uploadRes as any)?.then === 'function') {\n          // Cannot await in current sync interface; report temporary unavailability in this environment.\n          return { ok: false, error: { code: STORAGE_ERROR.STORAGE_UNAVAILABLE, message: 'Async SDK upload not supported in sync context' } };\n        }\n      } catch (e: any) {\n        // On any SDK error, map to STORAGE_UNAVAILABLE per contract\n        return { ok: false, error: { code: STORAGE_ERROR.STORAGE_UNAVAILABLE, message: e?.message || 'Storage unavailable' } };\n      }\n    }\n\n    const composite = `${bucket}/${key}`;\n    memoryBucket.add(composite);\n    const storage_path = `supabase://${bucket}/${key}`;\n    return { ok: true, storage_path };\n  } catch (e: any) {\n    return { ok: false, error: { code: STORAGE_ERROR.STORAGE_UNAVAILABLE, message: e?.message || 'Storage unavailable' } };\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 533, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/lib/templates/service.ts"],"sourcesContent":["import { randomUUID } from 'crypto';\nimport { CreateTemplateInput, TemplateMetadata } from './types';\nimport { ERROR } from './validation';\nimport { existsStoragePath } from '../storage/supabaseClient';\n\n// In-memory store as a placeholder until DB integration (Supabase) is added.\nconst STORE: Record<string, TemplateMetadata> = {};\n\nfunction nowISO(): string {\n  return new Date().toISOString();\n}\n\nexport function createTemplate(input: CreateTemplateInput, createdBy: string): { ok: true; id: string } | { ok: false; error: { code: string; message: string } } {\n  {\n    const chk = existsStoragePath(String(input.storage_path));\n    if (!chk.ok) return { ok: false, error: { code: ERROR.STORAGE_UNAVAILABLE, message: 'Storage unavailable' } };\n    if (!chk.exists) return { ok: false, error: { code: ERROR.STORAGE_PATH_INVALID, message: 'Invalid or unreachable storage_path' } };\n  }\n  const id = randomUUID();\n  const record: TemplateMetadata = {\n    id,\n    name: String(input.name),\n    type: input.type as any,\n    storage_path: String(input.storage_path),\n    version: input.version ?? 1,\n    created_by: createdBy,\n    created_at: nowISO(),\n  };\n  STORE[id] = record;\n  return { ok: true, id };\n}\n\nexport function listTemplates(): TemplateMetadata[] {\n  return Object.values(STORE);\n}\n\nexport function getTemplate(id: string): TemplateMetadata | null {\n  return STORE[id] ?? null;\n}\n\nexport function updateTemplate(\n  id: string,\n  input: CreateTemplateInput,\n  uid: string\n):\n  | { ok: true; record: TemplateMetadata }\n  | { ok: false; error: { code: string; message: string } } {\n  const existing = STORE[id];\n  if (!existing) return { ok: false, error: { code: ERROR.NOT_FOUND, message: 'Template not found' } };\n  if (existing.created_by !== uid) return { ok: false, error: { code: ERROR.FORBIDDEN, message: 'Forbidden' } };\n\n  {\n    const chk = existsStoragePath(String(input.storage_path));\n    if (!chk.ok) return { ok: false, error: { code: ERROR.STORAGE_UNAVAILABLE, message: 'Storage unavailable' } };\n    if (!chk.exists) return { ok: false, error: { code: ERROR.STORAGE_PATH_INVALID, message: 'Invalid or unreachable storage_path' } };\n  }\n\n  const updated: TemplateMetadata = {\n    id: existing.id,\n    name: String(input.name),\n    type: input.type as any,\n    storage_path: String(input.storage_path),\n    version: input.version ?? existing.version,\n    created_by: existing.created_by,\n    created_at: existing.created_at,\n  };\n  STORE[id] = updated;\n  return { ok: true, record: updated };\n}\n\nexport function deleteTemplate(\n  id: string,\n  uid: string\n): { ok: true } | { ok: false; error: { code: string; message: string } } {\n  const existing = STORE[id];\n  if (!existing) return { ok: false, error: { code: ERROR.NOT_FOUND, message: 'Template not found' } };\n  if (existing.created_by !== uid) return { ok: false, error: { code: ERROR.FORBIDDEN, message: 'Forbidden' } };\n  delete STORE[id];\n  return { ok: true };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AAEA;AACA;;;;AAEA,6EAA6E;AAC7E,MAAM,QAA0C,CAAC;AAEjD,SAAS;IACP,OAAO,IAAI,OAAO,WAAW;AAC/B;AAEO,SAAS,eAAe,KAA0B,EAAE,SAAiB;IAC1E;QACE,MAAM,MAAM,IAAA,2NAAiB,EAAC,OAAO,MAAM,YAAY;QACvD,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;YAAE,IAAI;YAAO,OAAO;gBAAE,MAAM,6MAAK,CAAC,mBAAmB;gBAAE,SAAS;YAAsB;QAAE;QAC5G,IAAI,CAAC,IAAI,MAAM,EAAE,OAAO;YAAE,IAAI;YAAO,OAAO;gBAAE,MAAM,6MAAK,CAAC,oBAAoB;gBAAE,SAAS;YAAsC;QAAE;IACnI;IACA,MAAM,KAAK,IAAA,sPAAU;IACrB,MAAM,SAA2B;QAC/B;QACA,MAAM,OAAO,MAAM,IAAI;QACvB,MAAM,MAAM,IAAI;QAChB,cAAc,OAAO,MAAM,YAAY;QACvC,SAAS,MAAM,OAAO,IAAI;QAC1B,YAAY;QACZ,YAAY;IACd;IACA,KAAK,CAAC,GAAG,GAAG;IACZ,OAAO;QAAE,IAAI;QAAM;IAAG;AACxB;AAEO,SAAS;IACd,OAAO,OAAO,MAAM,CAAC;AACvB;AAEO,SAAS,YAAY,EAAU;IACpC,OAAO,KAAK,CAAC,GAAG,IAAI;AACtB;AAEO,SAAS,eACd,EAAU,EACV,KAA0B,EAC1B,GAAW;IAIX,MAAM,WAAW,KAAK,CAAC,GAAG;IAC1B,IAAI,CAAC,UAAU,OAAO;QAAE,IAAI;QAAO,OAAO;YAAE,MAAM,6MAAK,CAAC,SAAS;YAAE,SAAS;QAAqB;IAAE;IACnG,IAAI,SAAS,UAAU,KAAK,KAAK,OAAO;QAAE,IAAI;QAAO,OAAO;YAAE,MAAM,6MAAK,CAAC,SAAS;YAAE,SAAS;QAAY;IAAE;IAE5G;QACE,MAAM,MAAM,IAAA,2NAAiB,EAAC,OAAO,MAAM,YAAY;QACvD,IAAI,CAAC,IAAI,EAAE,EAAE,OAAO;YAAE,IAAI;YAAO,OAAO;gBAAE,MAAM,6MAAK,CAAC,mBAAmB;gBAAE,SAAS;YAAsB;QAAE;QAC5G,IAAI,CAAC,IAAI,MAAM,EAAE,OAAO;YAAE,IAAI;YAAO,OAAO;gBAAE,MAAM,6MAAK,CAAC,oBAAoB;gBAAE,SAAS;YAAsC;QAAE;IACnI;IAEA,MAAM,UAA4B;QAChC,IAAI,SAAS,EAAE;QACf,MAAM,OAAO,MAAM,IAAI;QACvB,MAAM,MAAM,IAAI;QAChB,cAAc,OAAO,MAAM,YAAY;QACvC,SAAS,MAAM,OAAO,IAAI,SAAS,OAAO;QAC1C,YAAY,SAAS,UAAU;QAC/B,YAAY,SAAS,UAAU;IACjC;IACA,KAAK,CAAC,GAAG,GAAG;IACZ,OAAO;QAAE,IAAI;QAAM,QAAQ;IAAQ;AACrC;AAEO,SAAS,eACd,EAAU,EACV,GAAW;IAEX,MAAM,WAAW,KAAK,CAAC,GAAG;IAC1B,IAAI,CAAC,UAAU,OAAO;QAAE,IAAI;QAAO,OAAO;YAAE,MAAM,6MAAK,CAAC,SAAS;YAAE,SAAS;QAAqB;IAAE;IACnG,IAAI,SAAS,UAAU,KAAK,KAAK,OAAO;QAAE,IAAI;QAAO,OAAO;YAAE,MAAM,6MAAK,CAAC,SAAS;YAAE,SAAS;QAAY;IAAE;IAC5G,OAAO,KAAK,CAAC,GAAG;IAChB,OAAO;QAAE,IAAI;IAAK;AACpB","debugId":null}},
    {"offset": {"line": 672, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/api/pdf-generate.ts"],"sourcesContent":["import { RequestLike, ResponseLike } from './templates';\nimport { ERROR } from '../lib/templates/validation';\nimport { getTemplate } from '../lib/templates/service';\n\nfunction unauthorized(message = 'Missing or invalid Authorization header'): ResponseLike {\n  return { status: 401, body: { code: ERROR.UNAUTHORIZED, message } };\n}\n\nfunction parseAuthUid(headers: Record<string, string | undefined>): string | null {\n  const auth = headers['authorization'] || headers['Authorization'];\n  if (!auth) return null;\n  const m = /^Bearer\\s+user-(?<uid>[a-zA-Z0-9-]+)$/.exec(auth);\n  return m?.groups?.uid ?? null;\n}\n\nfunction nowMs(): number {\n  return Date.now();\n}\n\nfunction stubPdfBase64(): string {\n  const minimalPdf = '%PDF-1.1\\n%\\u25B5\\n1 0 obj\\n<<>>\\nendobj\\ntrailer\\n<<>>\\n%%EOF\\n';\n  return Buffer.from(minimalPdf, 'utf-8').toString('base64');\n}\n\nexport async function handlePostPdfGenerate(req: RequestLike): Promise<ResponseLike> {\n  const started = nowMs();\n  // E2E test hook: allow artificial delay via localStorage flags (browser-only)\n  try {\n    // eslint-disable-next-line no-undef\n    const ls: any = (typeof localStorage !== 'undefined') ? localStorage : null;\n    if (ls) {\n      const slow = ls.getItem('e2e_slow_pdf');\n      const delayStr = ls.getItem('e2e_delay_ms');\n      let delayMs = 0;\n      if (slow === 'true') delayMs = 6000; // exceed 5s timeout\n      if (delayStr && !isNaN(Number(delayStr))) delayMs = Math.max(delayMs, Number(delayStr));\n      if (delayMs > 0) {\n        await new Promise((r) => setTimeout(r, delayMs));\n      }\n    }\n  } catch {}\n  const uid = parseAuthUid(req.headers);\n  if (!uid) return unauthorized();\n\n  const body = (req.body ?? {}) as any;\n  if (!body || typeof body !== 'object') {\n    return {\n      status: 422,\n      body: { code: ERROR.VALIDATION_ERROR, message: 'Body must be an object' },\n    };\n  }\n\n  const { template_id, data } = body as { template_id?: unknown; data?: unknown };\n  if (!template_id || typeof template_id !== 'string') {\n    return {\n      status: 422,\n      body: { code: ERROR.VALIDATION_ERROR, message: 'template_id is required' },\n    };\n  }\n  if (!data || typeof data !== 'object') {\n    return {\n      status: 422,\n      body: { code: ERROR.VALIDATION_ERROR, message: 'data must be an object', details: { typeErrors: ['data must be object'] } },\n    };\n  }\n\n  const meta = getTemplate(template_id);\n  if (!meta) {\n    return { status: 404, body: { code: ERROR.NOT_FOUND, message: 'Template not found' } };\n  }\n\n  // NOTE: Minimal stub – actual schema vs data validation will be added in renderer story.\n  try {\n    const pdf_base64 = stubPdfBase64();\n    const elapsed = Math.max(0, nowMs() - started);\n    return { status: 200, headers: { 'x-processing-ms': String(elapsed), 'Content-Type': 'application/json' }, body: { pdf_base64 } };\n  } catch (e: any) {\n    return { status: 503, body: { code: 'GENERATOR_UNAVAILABLE', message: e?.message || 'Generator unavailable' } } as ResponseLike;\n  }\n}\n"],"names":[],"mappings":";;;;AAqBS;AApBT;AACA;;;AAEA,SAAS,aAAa,UAAU,yCAAyC;IACvE,OAAO;QAAE,QAAQ;QAAK,MAAM;YAAE,MAAM,6MAAK,CAAC,YAAY;YAAE;QAAQ;IAAE;AACpE;AAEA,SAAS,aAAa,OAA2C;IAC/D,MAAM,OAAO,OAAO,CAAC,gBAAgB,IAAI,OAAO,CAAC,gBAAgB;IACjE,IAAI,CAAC,MAAM,OAAO;IAClB,MAAM,IAAI,wCAAwC,IAAI,CAAC;IACvD,OAAO,GAAG,QAAQ,OAAO;AAC3B;AAEA,SAAS;IACP,OAAO,KAAK,GAAG;AACjB;AAEA,SAAS;IACP,MAAM,aAAa;IACnB,OAAO,oOAAM,CAAC,IAAI,CAAC,YAAY,SAAS,QAAQ,CAAC;AACnD;AAEO,eAAe,sBAAsB,GAAgB;IAC1D,MAAM,UAAU;IAChB,8EAA8E;IAC9E,IAAI;QACF,oCAAoC;QACpC,MAAM,KAAU,AAAC,OAAO,iBAAiB,cAAe,eAAe;QACvE,IAAI,IAAI;YACN,MAAM,OAAO,GAAG,OAAO,CAAC;YACxB,MAAM,WAAW,GAAG,OAAO,CAAC;YAC5B,IAAI,UAAU;YACd,IAAI,SAAS,QAAQ,UAAU,MAAM,oBAAoB;YACzD,IAAI,YAAY,CAAC,MAAM,OAAO,YAAY,UAAU,KAAK,GAAG,CAAC,SAAS,OAAO;YAC7E,IAAI,UAAU,GAAG;gBACf,MAAM,IAAI,QAAQ,CAAC,IAAM,WAAW,GAAG;YACzC;QACF;IACF,EAAE,OAAM,CAAC;IACT,MAAM,MAAM,aAAa,IAAI,OAAO;IACpC,IAAI,CAAC,KAAK,OAAO;IAEjB,MAAM,OAAQ,IAAI,IAAI,IAAI,CAAC;IAC3B,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;QACrC,OAAO;YACL,QAAQ;YACR,MAAM;gBAAE,MAAM,6MAAK,CAAC,gBAAgB;gBAAE,SAAS;YAAyB;QAC1E;IACF;IAEA,MAAM,EAAE,WAAW,EAAE,IAAI,EAAE,GAAG;IAC9B,IAAI,CAAC,eAAe,OAAO,gBAAgB,UAAU;QACnD,OAAO;YACL,QAAQ;YACR,MAAM;gBAAE,MAAM,6MAAK,CAAC,gBAAgB;gBAAE,SAAS;YAA0B;QAC3E;IACF;IACA,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;QACrC,OAAO;YACL,QAAQ;YACR,MAAM;gBAAE,MAAM,6MAAK,CAAC,gBAAgB;gBAAE,SAAS;gBAA0B,SAAS;oBAAE,YAAY;wBAAC;qBAAsB;gBAAC;YAAE;QAC5H;IACF;IAEA,MAAM,OAAO,IAAA,gNAAW,EAAC;IACzB,IAAI,CAAC,MAAM;QACT,OAAO;YAAE,QAAQ;YAAK,MAAM;gBAAE,MAAM,6MAAK,CAAC,SAAS;gBAAE,SAAS;YAAqB;QAAE;IACvF;IAEA,yFAAyF;IACzF,IAAI;QACF,MAAM,aAAa;QACnB,MAAM,UAAU,KAAK,GAAG,CAAC,GAAG,UAAU;QACtC,OAAO;YAAE,QAAQ;YAAK,SAAS;gBAAE,mBAAmB,OAAO;gBAAU,gBAAgB;YAAmB;YAAG,MAAM;gBAAE;YAAW;QAAE;IAClI,EAAE,OAAO,GAAQ;QACf,OAAO;YAAE,QAAQ;YAAK,MAAM;gBAAE,MAAM;gBAAyB,SAAS,GAAG,WAAW;YAAwB;QAAE;IAChH;AACF","debugId":null}},
    {"offset": {"line": 797, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/lib/pdf/request.ts"],"sourcesContent":["import { handlePostPdfGenerate } from '../../api/pdf-generate';\n\nexport interface GeneratePdfOptions {\n  timeoutMs?: number;\n  transport?: (req: any) => Promise<{ status: number; headers?: Record<string, string>; body: any }>;\n}\n\nexport interface GeneratePdfResult {\n  pdfBase64: string;\n  dataUrl: string;\n}\n\nexport function buildPdfPayload(templateId: string, values: Record<string, any>) {\n  return {\n    template_id: templateId,\n    data: values ?? {},\n  };\n}\n\nexport async function generatePdf(\n  templateId: string,\n  values: Record<string, any>,\n  opts: GeneratePdfOptions = {}\n): Promise<GeneratePdfResult> {\n  const timeoutMs = opts.timeoutMs ?? 5000;\n  const transport = opts.transport ?? (async (req: any) => handlePostPdfGenerate(req as any));\n\n  const req = {\n    headers: { Authorization: 'Bearer user-test' },\n    body: buildPdfPayload(templateId, values),\n  };\n\n  return new Promise<GeneratePdfResult>((resolve, reject) => {\n    const timer = setTimeout(() => {\n      const err: any = new Error('PDF generation timed out');\n      err.code = 'PDF_TIMEOUT';\n      reject(err);\n    }, timeoutMs);\n\n    transport(req)\n      .then((resp) => {\n        clearTimeout(timer);\n        if (resp.status !== 200) {\n          const err: any = new Error(resp.body?.message || 'PDF generation failed');\n          err.code = resp.body?.code || 'PDF_ERROR';\n          err.details = resp.body?.details;\n          throw err;\n        }\n        const pdfBase64: string = resp.body?.pdf_base64;\n        const dataUrl = `data:application/pdf;base64,${pdfBase64}`;\n        resolve({ pdfBase64, dataUrl });\n      })\n      .catch((err) => {\n        clearTimeout(timer);\n        if (err && !err.code) {\n          err.code = err?.message ? 'PDF_ERROR' : 'UNKNOWN_ERROR';\n        }\n        reject(err);\n      });\n  });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAYO,SAAS,gBAAgB,UAAkB,EAAE,MAA2B;IAC7E,OAAO;QACL,aAAa;QACb,MAAM,UAAU,CAAC;IACnB;AACF;AAEO,eAAe,YACpB,UAAkB,EAClB,MAA2B,EAC3B,OAA2B,CAAC,CAAC;IAE7B,MAAM,YAAY,KAAK,SAAS,IAAI;IACpC,MAAM,YAAY,KAAK,SAAS,IAAI,CAAC,OAAO,MAAa,IAAA,qNAAqB,EAAC,IAAW;IAE1F,MAAM,MAAM;QACV,SAAS;YAAE,eAAe;QAAmB;QAC7C,MAAM,gBAAgB,YAAY;IACpC;IAEA,OAAO,IAAI,QAA2B,CAAC,SAAS;QAC9C,MAAM,QAAQ,WAAW;YACvB,MAAM,MAAW,IAAI,MAAM;YAC3B,IAAI,IAAI,GAAG;YACX,OAAO;QACT,GAAG;QAEH,UAAU,KACP,IAAI,CAAC,CAAC;YACL,aAAa;YACb,IAAI,KAAK,MAAM,KAAK,KAAK;gBACvB,MAAM,MAAW,IAAI,MAAM,KAAK,IAAI,EAAE,WAAW;gBACjD,IAAI,IAAI,GAAG,KAAK,IAAI,EAAE,QAAQ;gBAC9B,IAAI,OAAO,GAAG,KAAK,IAAI,EAAE;gBACzB,MAAM;YACR;YACA,MAAM,YAAoB,KAAK,IAAI,EAAE;YACrC,MAAM,UAAU,CAAC,4BAA4B,EAAE,WAAW;YAC1D,QAAQ;gBAAE;gBAAW;YAAQ;QAC/B,GACC,KAAK,CAAC,CAAC;YACN,aAAa;YACb,IAAI,OAAO,CAAC,IAAI,IAAI,EAAE;gBACpB,IAAI,IAAI,GAAG,KAAK,UAAU,cAAc;YAC1C;YACA,OAAO;QACT;IACJ;AACF","debugId":null}},
    {"offset": {"line": 856, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/lib/errors/pdf.ts"],"sourcesContent":["export type PdfErrorCode =\n  | 'PDF_TIMEOUT'\n  | 'UNAUTHORIZED'\n  | 'NOT_FOUND'\n  | 'VALIDATION_ERROR'\n  | 'GENERATOR_UNAVAILABLE'\n  | 'PDF_ERROR'\n  | string;\n\nconst defaultMessages: Record<string, string> = {\n  PDF_TIMEOUT: 'PDF 생성 시간이 초과되었습니다 (5초). 다시 시도해 주세요.',\n  UNAUTHORIZED: '인증이 필요합니다.',\n  NOT_FOUND: '템플릿을 찾을 수 없습니다.',\n  VALIDATION_ERROR: '입력 데이터가 유효하지 않습니다.',\n  GENERATOR_UNAVAILABLE: 'PDF 생성 서비스를 사용할 수 없습니다.',\n  PDF_ERROR: 'PDF 생성 중 오류가 발생했습니다.',\n};\n\nexport function getPdfErrorMessage(code: PdfErrorCode, t?: (key: string) => string): string {\n  // If i18n translator provided, prefer translation keys like 'pdf.error.PDF_TIMEOUT'\n  if (t) {\n    const key = `pdf.error.${code}`;\n    const translated = t(key);\n    if (translated && translated !== key) return translated;\n  }\n  return defaultMessages[code] || `오류가 발생했습니다: ${code}`;\n}\n\n"],"names":[],"mappings":";;;;AASA,MAAM,kBAA0C;IAC9C,aAAa;IACb,cAAc;IACd,WAAW;IACX,kBAAkB;IAClB,uBAAuB;IACvB,WAAW;AACb;AAEO,SAAS,mBAAmB,IAAkB,EAAE,CAA2B;IAChF,oFAAoF;IACpF,IAAI,GAAG;QACL,MAAM,MAAM,CAAC,UAAU,EAAE,MAAM;QAC/B,MAAM,aAAa,EAAE;QACrB,IAAI,cAAc,eAAe,KAAK,OAAO;IAC/C;IACA,OAAO,eAAe,CAAC,KAAK,IAAI,CAAC,YAAY,EAAE,MAAM;AACvD","debugId":null}},
    {"offset": {"line": 884, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/lib/pdf/util.ts"],"sourcesContent":["export function base64ToUint8Array(base64: string): Uint8Array {\n  if (typeof Buffer !== 'undefined') {\n    // Node/test env\n    return new Uint8Array(Buffer.from(base64, 'base64'));\n  }\n  // Browser fallback\n  const binary = atob(base64);\n  const len = binary.length;\n  const bytes = new Uint8Array(len);\n  for (let i = 0; i < len; i++) bytes[i] = binary.charCodeAt(i);\n  return bytes;\n}\n\nexport function createPdfBlobUrl(pdfBase64: string): string | null {\n  try {\n    const bytes = base64ToUint8Array(pdfBase64);\n    const blob = new Blob([bytes], { type: 'application/pdf' });\n    return URL.createObjectURL(blob);\n  } catch {\n    return null;\n  }\n}\n\n// Simple FNV-1a 32-bit hash for deterministic cache keys\nexport function fnv1a(str: string): string {\n  let h = 0x811c9dc5;\n  for (let i = 0; i < str.length; i++) {\n    h ^= str.charCodeAt(i);\n    h = Math.imul(h, 0x01000193);\n  }\n  // Convert to unsigned and hex\n  return (h >>> 0).toString(16).padStart(8, '0');\n}\n\nexport function makeTemplatePdfCacheKey(templateId: string, values: Record<string, any>): string {\n  const payload = JSON.stringify(values ?? {});\n  return `${templateId}:${fnv1a(payload)}`;\n}\n\n"],"names":[],"mappings":";;;;;;;;;;AACa;AADN,SAAS,mBAAmB,MAAc;IAC/C,IAAI,OAAO,oOAAM,KAAK,aAAa;QACjC,gBAAgB;QAChB,OAAO,IAAI,WAAW,oOAAM,CAAC,IAAI,CAAC,QAAQ;IAC5C;IACA,mBAAmB;IACnB,MAAM,SAAS,KAAK;IACpB,MAAM,MAAM,OAAO,MAAM;IACzB,MAAM,QAAQ,IAAI,WAAW;IAC7B,IAAK,IAAI,IAAI,GAAG,IAAI,KAAK,IAAK,KAAK,CAAC,EAAE,GAAG,OAAO,UAAU,CAAC;IAC3D,OAAO;AACT;AAEO,SAAS,iBAAiB,SAAiB;IAChD,IAAI;QACF,MAAM,QAAQ,mBAAmB;QACjC,MAAM,OAAO,IAAI,KAAK;YAAC;SAAM,EAAE;YAAE,MAAM;QAAkB;QACzD,OAAO,IAAI,eAAe,CAAC;IAC7B,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAGO,SAAS,MAAM,GAAW;IAC/B,IAAI,IAAI;IACR,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,IAAK;QACnC,KAAK,IAAI,UAAU,CAAC;QACpB,IAAI,KAAK,IAAI,CAAC,GAAG;IACnB;IACA,8BAA8B;IAC9B,OAAO,CAAC,MAAM,CAAC,EAAE,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG;AAC5C;AAEO,SAAS,wBAAwB,UAAkB,EAAE,MAA2B;IACrF,MAAM,UAAU,KAAK,SAAS,CAAC,UAAU,CAAC;IAC1C,OAAO,GAAG,WAAW,CAAC,EAAE,MAAM,UAAU;AAC1C","debugId":null}},
    {"offset": {"line": 940, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/apf_temp_admin/Desktop/3d-Configurator-interaction-estimate/src/app/templates/_components/EditPageClient.tsx"],"sourcesContent":["\"use client\";\nimport React, { useEffect, useState } from 'react';\nimport SchemaForm, { UISchema } from './SchemaForm';\nimport PdfPreview from './PdfPreview';\nimport { generatePdf, type GeneratePdfOptions } from '../../../lib/pdf/request';\nimport { getPdfErrorMessage } from '../../../lib/errors/pdf';\nimport { createPdfBlobUrl, makeTemplatePdfCacheKey } from '../../../lib/pdf/util';\n\nfunction getMockSchema(templateId: string): UISchema | null {\n  if (!templateId) return null;\n  return {\n    sections: [\n      {\n        section_id: 'basic',\n        title: '기본 정보',\n        fields: [\n          { type: 'text', pdf_field_name: 'company', label: '회사명', required: true },\n          { type: 'checkbox', pdf_field_name: 'need_demo', label: '데모 요청' },\n          { type: 'select', pdf_field_name: 'size', label: '규모', options: ['S', 'M', 'L'], required: true },\n        ],\n      },\n    ],\n  };\n}\n\ntype Mode = 'preview' | 'download';\n\nexport default function EditPageClient({ templateId, pdfOptions }: { templateId: string; pdfOptions?: GeneratePdfOptions }) {\n  const [mode, setMode] = useState<Mode>('preview');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [previewSrc, setPreviewSrc] = useState<string | null>(null);\n  const [lastValues, setLastValues] = useState<Record<string, any>>({});\n  const [previewCacheKey, setPreviewCacheKey] = useState<string | null>(null);\n\n  // Revoke blob URLs on change/unmount to avoid leaks\n  useEffect(() => {\n    return () => {\n      if (previewSrc && previewSrc.startsWith('blob:')) {\n        try { URL.revokeObjectURL(previewSrc); } catch {}\n      }\n    };\n  }, [previewSrc]);\n\n  if (!templateId) return <div role=\"alert\">templateId가 필요합니다</div>;\n  const schema = getMockSchema(templateId);\n  if (!schema) return <div role=\"status\">스키마가 없습니다</div>;\n\n  async function onGenerate() {\n    setError(null);\n    setLoading(true);\n    try {\n      const { dataUrl, pdfBase64 } = await generatePdf(templateId, lastValues, { timeoutMs: 5000, ...(pdfOptions || {}) });\n      const blobUrl = pdfBase64 ? createPdfBlobUrl(pdfBase64) : null;\n      const url = blobUrl || dataUrl;\n      if (mode === 'preview') {\n        setPreviewSrc(url);\n      } else {\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = `quote-${templateId}-${Date.now()}.pdf`;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n      }\n    } catch (e: any) {\n      const code = e?.code || 'PDF_ERROR';\n      setError(getPdfErrorMessage(code));\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  return (\n    <main>\n      <h1>Template Edit</h1>\n      <div style={{ marginBottom: 12 }}>\n        <label>\n          <input type=\"radio\" name=\"mode\" value=\"preview\" checked={mode === 'preview'} onChange={() => setMode('preview')} /> Preview\n        </label>\n        <label style={{ marginLeft: 12 }}>\n          <input type=\"radio\" name=\"mode\" value=\"download\" checked={mode === 'download'} onChange={() => setMode('download')} /> Download\n        </label>\n        <button onClick={onGenerate} disabled={loading} aria-busy={loading} aria-label=\"Generate PDF\" style={{ marginLeft: 12 }}>\n          {loading ? 'Generating…' : 'Generate'}\n        </button>\n      </div>\n      {error && (\n        <div role=\"alert\" aria-live=\"assertive\" style={{ color: '#d00', marginBottom: 8 }}>\n          {error}\n        </div>\n      )}\n      <SchemaForm\n        templateId={templateId}\n        schema={schema}\n        onValuesChange={(vals) => {\n          setLastValues(vals);\n          // Clear preview when inputs change to respect cache invalidation note\n          setPreviewSrc(null);\n          setPreviewCacheKey(makeTemplatePdfCacheKey(templateId, vals));\n        }}\n      />\n      {previewSrc && mode === 'preview' && <PdfPreview src={previewSrc} />}\n    </main>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}