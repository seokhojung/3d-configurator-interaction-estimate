# BMAD 워크플로우 가이드

본 문서는 이 리포지토리에서 BMAD METHOD를 실행하기 위한 표준 워크플로우를 요약합니다. 역할별 책임, 체크리스트, 명령, 산출물, 상태 전이를 한눈에 확인할 수 있습니다.

## 목적/범위
- 적용 대상: `docs/stories/*.story.md` 전체 스토리 라이프사이클
- 표준 단계: 개발 → 테스트 → 체크리스트 체크 → QA 게이트 → 상태 변경
- 금지: `AGENTS.md`의 자동 생성 영역(`<!-- BEGIN: BMAD-AGENTS --> … <!-- END -->`) 직접 수정 금지

## 단계별 흐름(순서 명시)
1) 스토리 드래프트(SM)
- 명령: `As sm, *draft`
- 작업: PRD/아키텍처 참조로 스토리 초안 작성 → 앵커 검증 `npm run docs:check`
- 선행 점검: 최신 스토리의 상태가 Done인지 확인, 미완 존재 시 팀에 알리고 진행 여부 결정
- 체크리스트: `As sm, *story-checklist` 실행(Story Draft Checklist) 후 보완
- 핸드오프: PO 검토 요청
- 유의: SM은 코드/문서 구현을 하지 않으며 스토리 작성·정합성에만 집중

2) 스토리 승인(PO)
- 명령: `As po, *validate-story-draft {story}`
- 작업: 초안 검토/수정 제안 → 승인 시 Status `Ready`로 변경, Change Log 기록
- 체크리스트(선택): `As po, *execute-checklist-po`로 PO 마스터 체크리스트 실행 가능

3) 개발 착수(Dev)
- 전제: 스토리 Status가 `Ready`
- 명령: `As dev, *develop-story {story}`
- 반복 절차(각 Task/Subtask마다): Read Task → Implement → Write tests → Run tests → `[x]` 체크 업데이트 → File List/Dev Agent Record 갱신
- 테스트: `npm run test:unit`, `npm run test:integration`

[누락 방지: 미니 가드]
- 매 Task/Subtask 완료 즉시 아래 2가지를 반드시 수행한다.
  1) 해당 체크박스를 `[x]`로 변경(스토리 파일 Tasks 섹션)
  2) Dev Agent Record 내 Debug Log/Completion Notes/File List 수시 갱신
- End-of-loop 명령(복사/붙여넣기):
  - `npm run test:unit && npm run test:integration`
- 체크박스 미체크 탐지(예시 명령)
  - PowerShell: `Select-String -Path "docs/stories/{story}.story.md" -Pattern "- \[ \]"`
  - (옵션) ripgrep: `rg -n "- \[ \]" docs/stories/{story}.story.md`
  - 결과가 0줄이 아닐 경우, 상태 변경 금지 → 해당 항목 먼저 처리

4) Dev DoD(Dev)
- 문서 검사: `npm run docs:check`
- 체크리스트: Dev DoD Checklist 실행(`.bmad-core/checklists/story-dod-checklist.md`)
- 상태 변경: DoD 충족 시 Status를 `Ready for Review`로 변경(Dev 권한 범위)

[누락 방지: Ready for Review 게이트(필수 충족)]
- 아래 5개 모두 충족 시에만 상태 변경:
  1) Unit 테스트 통과 (`npm run test:unit` 그린)
  2) Integration 테스트 통과 (`npm run test:integration` 그린)
  3) 문서 앵커 검사 통과 (`npm run docs:check` 그린)
  4) Tasks/Subtasks에 미체크(`- [ ]`) 없음(모두 `[x]`)
  5) Dev DoD Checklist 실행 완료(체크 완료 기록)

검증용 간단 명령 세트(복사/붙여넣기):
- `npm run test:unit && npm run test:integration && npm run docs:check`
- PowerShell: `Select-String -Path "docs/stories/{story}.story.md" -Pattern "- \[ \]"`
  - 출력이 비어야 함(비어있지 않으면 남은 Subtask 처리 후 재실행)

### 테스트 실행 표준(완료 판정)
- 유닛: `npm run test:unit` → 마커 `::VITEST_DONE SUITE=unit CODE=0` 확인
- 통합: `npm run test:integration` → 마커 `::VITEST_DONE SUITE=integration CODE=0` 확인
- 전체: `npm test`
- 상세 로그: `test-results\unit.log`, `test-results\integration.log`

5) QA 게이트(QA)
- 명령: `As qa, *review {story}`
- 작업: 스토리 `## QA Results` 섹션 작성(AC별 판단/리스크/근거) + 게이트 파일 생성 `docs/qa/gates/{epic}.{story}-{slug}.yml`
- 결정: PASS/CONCERNS/FAIL/WAIVED
- 권한: 스토리 파일에서 QA는 오직 `## QA Results` 섹션만 수정(타 섹션 수정 금지)

6) 최종 승인/승격(PO)
- 명령: `As po, *execute-checklist-po`
- 작업: QA 결정 확인, 필요 시 보완 요청; PASS(또는 승인된 WAIVED) 시 Status `Done`으로 승격, Change Log 기록
- 되돌림: CONCERNS/FAIL이면 Dev로 반환(3단계로 회귀)

## 역할별 책임과 명령

### Scrum Master (SM)
- 주요 명령(IDE에서):
  - 스토리 생성: `As sm, *draft`
  - 드래프트 점검: `As sm, *story-checklist`
- 산출물/결과:
  - 새 스토리: `docs/stories/{epic}.{n}.story.md` (초기 Status: Draft → PO 승인 시 Ready)
  - 문서 앵커 유효성: `npm run docs:check`

### Developer (Dev)
- 주요 명령:
  - 스토리 구현: `As dev, *develop-story {story}` (예: `*develop-story 1.7`)
  - 테스트 실행: `npm run test:unit`, `npm run test:integration`
  - 문서 앵커 검사: `npm run docs:check`
- 구현 순서(강제):
  - Read (첫/다음) Task → Implement → Write tests → Execute validations → [x] 체크 업데이트 → File List 반영 → 반복
- 스토리 파일 편집 허용(Dev):
  - Tasks/Subtasks 체크박스
  - `## Dev Agent Record` 및 하위 섹션(Agent Model Used, Debug Log, Completion Notes, File List, Change Log)
  - Status를 `Ready for Review`로 갱신(DoD 충족 시)
- DoD 체크(요약):
  - Unit/Integration 통과, 문서 앵커 통과, 에러 계약 준수(`{ code, message, details? }`, 우선순위 `401 > 404/403 > 422 > 400/503`), 파일 리스트 최신화

### Test Architect & QA (QA)
- 주요 명령:
  - 종합 리뷰/게이트: `As qa, *review {story}` 또는 `As qa, *gate {story}`
- 산출물/결과:
  - 스토리 내 `## QA Results` 섹션 작성(AC별 판단/리스크/근거)
  - 게이트 파일 생성: `docs/qa/gates/{epic}.{story}-{slug}.yml` (결정: PASS/CONCERNS/FAIL/WAIVED)

### Product Owner (PO)
- 주요 명령:
  - 드래프트 승인: `As po, *validate-story-draft {story}` → Status `Ready`
  - 체크리스트: `As po, *execute-checklist-po`
  - 상태 변경: QA PASS 후 Status `Done`, Change Log 기록

## 체크리스트 파일 경로
- SM: `.bmad-core/checklists/story-draft-checklist.md`
- Dev: `.bmad-core/checklists/story-dod-checklist.md`
- PO: `.bmad-core/checklists/po-master-checklist.md`

## 개발/테스트 표준(요약)
- 언어/런타임: Node >=18 <=22, TypeScript, ESM, `strict: true`
- 오류 계약: `{ code, message, details? }` 고정, 우선순위 `401 > 404/403 > 422 > 400/503`
- 테스트 명명: Unit `*.spec.ts`, Integration `*.int.spec.ts`
- 디렉토리: `src/**`, `tests/unit/**`, `tests/integration/**`, `e2e/**`

## 상태 전이
- Draft(SM 생성) → Ready(PO 승인) → Ready for Review(Dev DoD 완료) → Done(PO, QA PASS 후)
- QA CONCERNS/FAIL 시: Dev로 반환(수정 → 재검증)

## 산출물 요약
- 스토리: `docs/stories/{epic}.{n}.story.md`
- QA 게이트: `docs/qa/gates/{epic}.{story}-{slug}.yml`
- 테스트 로그: CI/로컬 콘솔 출력(필요 시 `docs/qa/test-run-guide.md` 참조)

## 실행 예시(Story 1.7)
1) SM: `As sm, *draft` → `*story-checklist` → `npm run docs:check`
2) PO: `As po, *validate-story-draft 1.7` → Status `Ready`
3) Dev: `As dev, *develop-story 1.7` → 각 Task 구현/테스트/체크박스/파일리스트 갱신 → `npm run test:unit`, `npm run test:integration`
4) Dev DoD: `npm run docs:check` → DoD 체크리스트 실행 → Status `Ready for Review`
5) QA: `As qa, *review 1.7` → QA Results + 게이트 파일 생성(판정)
6) PO: `As po, *execute-checklist-po` → QA PASS 확인 후 Status `Done` + Change Log 기록

## 주의사항
- `AGENTS.md` 자동 생성 영역은 절대 수동 수정 금지
- 스토리 파일은 역할 권한에 맞춰 필요한 섹션만 수정
- 외부 의존성 추가가 필요한 경우 사전 승인 및 라이선스/보안 검토 수행
