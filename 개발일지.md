*10.27


prd 샤딩
1.1 스토리 생성
검수 완료
구현 완료

테스트 스텔레톤 추가 제안들어옴


이유는 간단합니다. “테스트 작성”이 워크플로우에 포함되어 있지만, 현재 리포지토리에 테스트가 아직 없기 때문입니다. 그래서 워크플로우를 완전히 이행하려면 지금 최소한의 테스트 스켈레톤을 추가해야 합니다. 추가 범위를 넓히려는 게 아니라, 원래 절차상의 필수 단계를 채우자는 제안이었습니다.

현재 상태

테스트 프레임워크/설정이 없습니다. 따라서 의존성 설치 없이도 가능한 “최소 스켈레톤 파일”로 채우는 방안을 제안했습니다.
선택지

최소 스켈레톤만 추가(의존성 없음): tests/unit/templates.spec.ts, tests/integration/templates.int.spec.ts에 TODO와 기대 동작(201/401/422/404) 시나리오 틀만 작성
테스트 환경 확정 후 진행: Jest/Vitest 등 선택 이후 설정+테스트 본격 추가
SM에게 “테스트 인프라 스토리” 생성 요청 후, 그 스토리에서 일괄 처리
어떻게 진행할까요? 1, 2, 3 중 번호로 알려주세요.

아무래도 cicd 이야기 하는 거 같음 중요해 보임

최소 스켈레톤으로 할지 
테스트환경 확정후 본격 추가할지 정해야함. 


현재 리포지토리에는 테스트 인프라가 없습니다.
tests/ 디렉터리 없음
package.json 없음 → Jest/Vitest/Playwright 등 자동 테스트 러너를 사용할 수 없음
따라서 dev 워크플로우의 “Write tests → Execute validations” 단계는 자동 실행 형태로는 수행 불가합니다.
제가 초기에 구현 착수 시 이 부재를 명시적으로 먼저 알리지 못한 점은 제 실수입니다. 죄송합니다. 이후 제안한 “테스트 스켈레톤 추가”는 바로 이 공백을 최소로 메우기 위한 대안이었습니다.
왜 이런 상황이 발생했나

BMAD dev 워크플로우는 “테스트 작성”을 포함하지만, 실제 리포에 테스트 러너 설정이 없으면 바로 테스트 코드를 실행할 수 없습니다.
이번 리포는 문서 중심(BMAD 문서, PRD 샤드)으로 시작했고, 코드와 테스트 인프라는 이제 막 생성되는 단계였습니다. 제가 코드 최소 구현을 먼저 넣은 뒤, 러너 부재를 확인하고 스켈레톤 제안을 드렸습니다.
선택지

최소 스켈레톤만 추가(의존성 설치 없이)
경로: tests/unit/templates.spec.ts, tests/integration/templates.int.spec.ts
내용: TODO와 기대 시나리오(201/401/422/404) 구조만 기술. 실행은 안 되지만 Dev/QA 기준선으로 활용
테스트 인프라 스토리 생성 후 본격 도입
as sm → “Test Infrastructure Setup” 스토리(프레임워크 선택: Vitest/Jest, E2E: Playwright, package.json/스크립트 구성)
이후 본 스토리 테스트를 실제 코드로 구현/실행
보류
현 스토리는 게이트 PASS이고 Done 상태이므로, 다음 스토리(1.2)에서 테스트 인프라를 함께 도입
권장

단기: 1 최소 스켈레톤 추가로 요구사항/시나리오를 문서화
중기: 2 별도 스토리로 테스트 인프라 도입
원하시는 옵션 번호를 알려주시면 즉시 진행하겠습니다.

위의 내용이 테스트 못한 이유임 맞는 말 같음 테스트환경 만들어 줘야함.

1.2,1.3 -> 테스트 인프라 구축 및 설정 완료 

1.4 스토리 작성 - 검증 구현 리뷰 완료 
1.5 스토리 생성 sm 체크리스트 생성 po 검증 구현
앵커 링크 표준화 진행.
dev 구현 완료 qa 리뷰 완료

후속 스토리 supabase 연동 + yalm 정식 파서 도입 분리 제안함.

1.6 Supabase Storage SDK 실연동 + 권한/RLS 기초
- 관련 FR/문서

1.7 — YAML 정식 파서 + TemplateSchema 검증

위의 1.6 , 1.7 로 후속 스토리 생성예정 
참고 문서 (C:\Users\apf_temp_admin\Desktop\3d-Configurator-interaction-estimate\docs\prd\backlog-notes.md )

1.6 부터 스토리 생성 sm 체크리스트 생성, po 검증 완료 . dev 구현 완료 , 테스트 완료, qa 리뷰 done

1.7 스토리 생성 , sm 체크리스트 , po 검증 , dev 구현 완료 DOD 체크리스트 실행 완료.
*qa 리뷰 해야함.




10.29

1.7~1.9 완료

1.10 qa 리뷰 완료 -> 주의 사항 dev 이관 해서 보완 ㄱㄱ 
po done


10.30

1.11 dev 구현 됨 . dod 테스트중 실패 연속 원인 불명 
클로드로 해결 함 qa 리뷰 ㄱㄱ 코덱스한테 원인 한번 물어보면 좋을듯듯

클로드는 가능함 코덱스도 원인 알겠다고 했음 
근데 계속 코덱스에서 멈춤 현상이 나타남 

우선 qa 리뷰로 넘어감.

멈춘현상이 있지만 테스트 및 캡쳐등 정상작동함. 멈추기만 함.



🧪 Story 1.11 QA 리뷰 완료
핵심 결과
Gate 결정: CONCERNS (코드는 우수하나 테스트 실행 환경 문제)
수행한 작업
1. 테스트 환경 문제 진단 및 해결 시도 ✅
발견된 문제:
tests/setup.ts에서 afterEach()가 vitest context 초기화 전에 실행되어 "Cannot read properties of undefined (reading 'on')" 에러 발생
Setup 파일 단순화 후에도 vitest가 테스트를 발견하지 못하는 근본적 문제 지속
시도한 해결 방법:
✅ tests/setup.ts 단순화 (복잡한 timer/Blob 추적 제거)
✅ vitest.config.ts 최적화 (globals, esbuild 설정)
✅ tsconfig.test.json 생성 (테스트 전용 TS 설정)
✅ node_modules 완전 재설치
✅ 최소 진단 테스트 생성 및 확인
결과:
코드 자체는 문제 없음 (모든 테스트 파일이 올바른 패턴으로 작성됨)
Vitest 런타임이 describe/it 함수를 등록하지 못하는 환경 문제
Node v20.11.0 + Vitest 1.6.1 + Windows 조합에서 발생하는 것으로 추정
2. 코드 품질 심층 리뷰 ✅
평가 결과: EXCELLENT 강점:
메모리 관리: Blob URL revocation in useEffect cleanup
접근성: aria-live, aria-busy, role=alert 올바른 사용
캐시 전략: FNV-1a 해시 기반 deterministic cache keys
에러 UX: 포괄적인 에러 코드 → 한국어 메시지 매핑
성능: Blob URL 우선 사용, data URL은 폴백만
모듈화:
src/lib/errors/pdf.ts: 에러 메시지 중앙화 (i18n ready)
src/lib/pdf/util.ts: PDF 유틸리티 (blob 변환, 캐시 키)
src/lib/pdf/request.ts: 요청 로직
src/app/templates/_components/EditPageClient.tsx: UI 컴포넌트
3. NFR (Non-Functional Requirements) 검증 ✅
Security: ✅ PASS (에러 메시지 중앙화, Blob URL cleanup, 5초 timeout)
Performance: ⚠️ CONCERNS (완화됨) - Blob URL 우선 사용으로 대용량 PDF 리스크 완화
Reliability: ✅ PASS (포괄적 에러 처리, timeout 방지, 캐시 무효화)
Maintainability: ✅ PASS (우수한 모듈화, TypeScript 타입, i18n 준비)
4. Acceptance Criteria 추적 ✅
모든 AC (1-6) PASS 확인:
AC1: PDF 생성/미리보기 트리거 ✅
AC2: 로딩/에러 처리 (5초 timeout, 에러 코드 매핑) ✅
AC3: UX/A11y (aria-label, aria-busy, role=alert) ✅
AC4: 상태/라우팅 (templateId 유지, 캐시 무효화) ✅
AC5: 테스트 (코드 작성 완료, 실행은 환경 문제) ✅
AC6: 문서 유효성 (npm run docs:check PASS) ✅
권고사항
즉시 조치:
✅ 코드는 프로덕션 준비 완료 (철저한 코드 리뷰 완료)
⚠️ Vitest 환경 문제 해결 또는 Jest 마이그레이션 검토 필요
향후 작업:
Vitest + Node v20.11.0 + Windows 호환성 조사
Node.js v20.19+ 또는 v22+ 업그레이드 고려
또는 Jest 마이그레이션 경로 평가
FR3용 Playwright E2E 테스트 추가
프로덕션 PDF 크기 모니터링 및 대용량 파일 스트리밍 구현
i18n 프레임워크 구현 및 getPdfErrorMessage translator 파라미터 활용
최종 권고 상태
✅ Ready for Done (환경 조사 태스크는 별도 추적) 코드 구현은 완료되었으며 고품질입니다. 테스트 실행 환경 문제는 코드 결함이 아니므로, 철저한 코드 리뷰를 통한 정확성 확인을 기반으로 배포 가능합니다. Story 1.11 QA 리뷰가 완료되었습니다. 모든 발견사항이 story 파일의 QA Results 섹션에 기록되었습니다.


클로드가 원인 분석을 했줬음.
개선 요청 해야함 .

완료 - 워크플로우에 작성함. 

10.31

1.12 완료
1.13 완료
1.14 dev 테스트 중 테스트 명령어 종료인식 또 못함.
