# BMAD 워크플로우 시각화

본 문서는 BMAD METHOD의 전체 워크플로우를 시각적으로 표현합니다.

> **시각화 도구**: 이 문서는 Mermaid 다이어그램을 사용합니다. VSCode에서 프리뷰 모드로 보거나 GitHub에서 자동 렌더링됩니다.
>
> **인터랙티브 버전**: 클릭/확장 가능한 마인드맵은 [워크플로우-인터랙티브.html](./워크플로우-인터랙티브.html)을 브라우저에서 열어보세요.

## 📊 전체 프로세스 흐름도 (Mermaid)

```mermaid
flowchart TD
    Start([BMAD 워크플로우 시작])

    SM1["1. 스토리 드래프트 - SM<br/>As sm, *draft<br/>PRD/아키텍처 참조<br/>앵커 검증<br/>산출물: story.md<br/>상태: Draft"]

    PO1["2. 스토리 승인 - PO<br/>As po, *validate-story-draft<br/>초안 검토 및 수정 제안<br/>Change Log 기록<br/>상태: Draft → Ready"]

    DEV1["3. 개발 착수 - Dev<br/>As dev, *develop-story<br/>반복: Read → Implement → Test<br/>체크박스 업데이트<br/>Dev Agent Record 갱신"]

    DOD1["4. Dev DoD<br/>5가지 조건 검증<br/>✓ Unit/Integration 테스트<br/>✓ 문서 앵커 검사<br/>✓ Tasks 체크 완료<br/>상태: Ready → Ready for Review"]

    QA1["5. QA 게이트<br/>As qa, *review<br/>QA Results 작성<br/>게이트 파일 생성<br/>판정: PASS/CONCERNS/FAIL/WAIVED"]

    PO2["6. 최종 승인 - PO<br/>As po, *execute-checklist-po<br/>QA PASS 확인<br/>Change Log 기록<br/>상태: Ready for Review → Done"]

    End([워크플로우 완료])

    Start --> SM1
    SM1 --> PO1
    PO1 -->|승인| DEV1
    PO1 -->|수정 필요| SM1
    DEV1 --> DOD1
    DOD1 -->|DoD 통과| QA1
    DOD1 -->|DoD 실패| DEV1
    QA1 -->|PASS/WAIVED| PO2
    QA1 -->|CONCERNS/FAIL| DEV1
    PO2 --> End

    style SM1 fill:#e1f5ff,stroke:#0288d1,stroke-width:3px
    style PO1 fill:#fff4e1,stroke:#ff9800,stroke-width:3px
    style DEV1 fill:#e8f5e9,stroke:#4caf50,stroke-width:3px
    style DOD1 fill:#fff3e0,stroke:#ff9800,stroke-width:3px
    style QA1 fill:#fce4ec,stroke:#e91e63,stroke-width:3px
    style PO2 fill:#fff4e1,stroke:#ff9800,stroke-width:3px
    style Start fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
    style End fill:#c8e6c9,stroke:#4caf50,stroke-width:2px
```

## 🎯 상태 전이 다이어그램 (Mermaid)

```mermaid
stateDiagram-v2
    [*] --> Draft: SM 생성
    Draft --> Ready: PO 승인
    Ready --> ReadyForReview: Dev DoD 완료
    ReadyForReview --> Done: PO 최종 승인<br/>(QA PASS)
    ReadyForReview --> Ready: QA FAIL/CONCERNS<br/>(Dev 재작업)
    Done --> [*]

    note right of Draft
        SM: 스토리 초안 작성
        As sm, *draft
    end note

    note right of Ready
        PO: 스토리 승인
        As po, *validate-story-draft
    end note

    note right of ReadyForReview
        Dev: 개발 완료
        5가지 DoD 조건 충족
    end note

    note right of Done
        PO: 최종 승격
        QA PASS 확인
    end note
```

## 🔄 개발 반복 사이클 (Mermaid)

```mermaid
flowchart TD
    START([Task 시작])
    READ["1. Read Task<br/>요구사항 및 AC 이해"]
    IMPL["2. Implement<br/>코드 작성 src/**"]
    TEST_W["3. Write Tests<br/>*.spec.ts, *.int.spec.ts"]
    TEST_R["4. Run Tests<br/>npm run test:unit<br/>npm run test:integration"]
    TEST_OK{"Tests OK?"}
    CHECKBOX["5. Update Checkbox<br/>[ ] → [x]"]
    RECORD["6. Update Dev Agent Record<br/>File List, Debug Log<br/>Completion Notes"]
    NEXT{"다음 Task?"}
    DOD([DoD 단계로])

    START --> READ
    READ --> IMPL
    IMPL --> TEST_W
    TEST_W --> TEST_R
    TEST_R --> TEST_OK
    TEST_OK -->|실패| IMPL
    TEST_OK -->|성공| CHECKBOX
    CHECKBOX --> RECORD
    RECORD --> NEXT
    NEXT -->|있음| READ
    NEXT -->|없음| DOD

    style START fill:#e8f5e9,stroke:#4caf50,stroke-width:2px
    style DOD fill:#c8e6c9,stroke:#4caf50,stroke-width:2px
    style TEST_OK fill:#fff3e0,stroke:#ff9800,stroke-width:2px
    style NEXT fill:#e1f5ff,stroke:#0288d1,stroke-width:2px
    style IMPL fill:#fff9c4,stroke:#fbc02d,stroke-width:2px
    style TEST_W fill:#f3e5f5,stroke:#9c27b0,stroke-width:2px
```

## 👥 역할별 책임 (Mermaid)

```mermaid
mindmap
  root((BMAD 워크플로우))
    SM[Scrum Master]
      *draft
      *story-checklist
      story.md 초안
      Draft 상태 생성
    PO[Product Owner]
      *validate-story-draft
      *execute-checklist-po
      Ready 상태 변경
      Done 상태 변경
      Change Log 기록
    Dev[Developer]
      *develop-story
      코드/테스트 작성
      Tasks 체크박스 관리
      Dev Agent Record 갱신
      Ready for Review 변경
    QA[Test Architect & QA]
      *review
      *gate
      QA Results 작성
      gate.yml 생성
      PASS/FAIL/CONCERNS/WAIVED
```

## 🚪 Ready for Review 게이트 (Mermaid)

```mermaid
flowchart LR
    START([Dev 작업 완료]) --> C1

    subgraph GATE[Ready for Review 게이트]
        C1[✓ Unit 테스트<br/>npm run test:unit]
        C2[✓ Integration 테스트<br/>npm run test:integration]
        C3[✓ 문서 앵커<br/>npm run docs:check]
        C4[✓ Tasks 체크<br/>미체크 없음]
        C5[✓ DoD Checklist<br/>실행 완료]

        C1 --> C2 --> C3 --> C4 --> C5
    end

    C5 --> CHECK{5가지 모두<br/>통과?}
    CHECK -->|실패| FAIL[상태 변경 불가<br/>Dev 재작업]
    CHECK -->|성공| PASS[상태 변경<br/>Ready → Ready for Review]

    FAIL --> START
    PASS --> QA([QA 게이트로])

    style GATE fill:#fff3e0
    style PASS fill:#c8e6c9
    style FAIL fill:#ffcdd2
```

## 🎭 QA 게이트 판정 흐름 (Mermaid)

```mermaid
flowchart TD
    START([QA 리뷰 시작]) --> REVIEW[As qa, *review]
    REVIEW --> WRITE[QA Results 작성<br/>AC별 판단/리스크/근거]
    WRITE --> GATE_FILE[게이트 파일 생성<br/>gate.yml]
    GATE_FILE --> DECISION{판정}

    DECISION -->|통과| PASS[PASS<br/>모든 AC 충족]
    DECISION -->|우려| CONCERNS[CONCERNS<br/>우려사항 존재]
    DECISION -->|실패| FAIL[FAIL<br/>심각한 문제]
    DECISION -->|면제| WAIVED[WAIVED<br/>문제 인지하나 승인]

    PASS --> PO_APPROVE[PO 최종 승인]
    WAIVED --> PO_APPROVE
    CONCERNS --> PO_DECISION{PO 판단}
    FAIL --> DEV_RETURN[Dev로 반환<br/>3단계 회귀]

    PO_DECISION -->|승인| PO_APPROVE
    PO_DECISION -->|반려| DEV_RETURN

    PO_APPROVE --> DONE([Done ✅])
    DEV_RETURN --> DEV([Dev 재작업])

    style PASS fill:#c8e6c9
    style CONCERNS fill:#fff9c4
    style FAIL fill:#ffcdd2
    style WAIVED fill:#e1bee7
    style DONE fill:#a5d6a7
```

## 📁 산출물 구조 (Mermaid)

```mermaid
graph TD
    ROOT[프로젝트 루트]

    ROOT --> DOCS[docs/]
    ROOT --> SRC[src/]
    ROOT --> TESTS[tests/]
    ROOT --> BMAD[.bmad-core/]

    DOCS --> STORIES[stories/]
    DOCS --> QA_DIR[qa/]

    STORIES --> STORY[epic.n.story.md<br/>SM 생성<br/>각 역할 담당 섹션 수정]

    QA_DIR --> GATES[gates/]
    GATES --> GATE_FILE[epic.story-slug.yml<br/>QA 생성]

    SRC --> TS[**/*.ts<br/>Dev 작성]

    TESTS --> UNIT[unit/]
    TESTS --> INTEGRATION[integration/]
    TESTS --> E2E[e2e/]

    UNIT --> UNIT_TEST[**/*.spec.ts<br/>Dev 작성]
    INTEGRATION --> INT_TEST[**/*.int.spec.ts<br/>Dev 작성]

    BMAD --> CHECKLISTS[checklists/]
    CHECKLISTS --> SM_CHECK[story-draft-checklist.md<br/>SM 사용]
    CHECKLISTS --> DEV_CHECK[story-dod-checklist.md<br/>Dev 사용]
    CHECKLISTS --> PO_CHECK[po-master-checklist.md<br/>PO 사용]

    style STORY fill:#e1f5ff
    style GATE_FILE fill:#fce4ec
    style TS fill:#e8f5e9
    style UNIT_TEST fill:#fff3e0
    style INT_TEST fill:#fff3e0
    style SM_CHECK fill:#e1f5ff
    style DEV_CHECK fill:#e8f5e9
    style PO_CHECK fill:#fff4e1
```

---

## 🚪 품질 게이트 체크포인트

### Ready for Review 진입 조건 (Dev DoD)

```
┌─────────────────────────────────────────────────────────┐
│  Ready for Review 게이트 - 필수 5가지 충족               │
├─────────────────────────────────────────────────────────┤
│  ✓ 1. Unit 테스트 통과                                   │
│      → npm run test:unit                                │
│                                                          │
│  ✓ 2. Integration 테스트 통과                            │
│      → npm run test:integration                         │
│                                                          │
│  ✓ 3. 문서 앵커 검사 통과                                │
│      → npm run docs:check                               │
│                                                          │
│  ✓ 4. 모든 Tasks/Subtasks 체크완료                      │
│      → Select-String -Pattern "- \[ \]" (결과 비어야 함) │
│                                                          │
│  ✓ 5. Dev DoD Checklist 실행 완료                       │
│      → .bmad-core/checklists/story-dod-checklist.md     │
└─────────────────────────────────────────────────────────┘
```

### QA 게이트 판정 기준

```
┌──────────────┬────────────────────────────────────────────┐
│   판정 결과   │              의미 및 다음 단계               │
├──────────────┼────────────────────────────────────────────┤
│    PASS      │ 모든 AC 충족 → PO 최종 승인 단계로 진행     │
├──────────────┼────────────────────────────────────────────┤
│   CONCERNS   │ 우려사항 존재 → PO 판단 필요                │
│              │ (Dev 반환 또는 조건부 승인)                 │
├──────────────┼────────────────────────────────────────────┤
│    FAIL      │ 심각한 문제 → Dev로 반환 (필수)             │
├──────────────┼────────────────────────────────────────────┤
│   WAIVED     │ 문제 인지하나 승인됨 → PO 승인 필요         │
└──────────────┴────────────────────────────────────────────┘
```


## 🎓 실행 예시 (Story 1.7)

```
1️⃣  SM 단계
    $ As sm, *draft
    $ As sm, *story-checklist
    $ npm run docs:check
    → 산출물: docs/stories/1.7.story.md (Status: Draft)

2️⃣  PO 승인
    $ As po, *validate-story-draft 1.7
    → 상태 변경: Draft → Ready

3️⃣  Dev 구현
    $ As dev, *develop-story 1.7
    → Task 1 구현 → 테스트 작성 → [x] 체크
    → Task 2 구현 → 테스트 작성 → [x] 체크
    → ...
    $ npm run test:unit
    $ npm run test:integration

4️⃣  Dev DoD
    $ npm run test:unit && npm run test:integration && npm run docs:check
    $ Select-String -Pattern "- \[ \]" docs/stories/1.7.story.md
    → DoD Checklist 실행
    → 상태 변경: Ready → Ready for Review

5️⃣  QA 리뷰
    $ As qa, *review 1.7
    → QA Results 섹션 작성
    → 게이트 파일 생성: docs/qa/gates/1.7-yaml-parser-templateschema-validation.yml
    → 판정: PASS

6️⃣  PO 최종 승인
    $ As po, *execute-checklist-po
    → QA PASS 확인
    → Change Log 기록
    → 상태 변경: Ready for Review → Done ✅
```

## ⚠️ 주요 주의사항

### 🚫 금지 사항

- `AGENTS.md`의 자동 생성 영역(`<!-- BEGIN: BMAD-AGENTS --> … <!-- END -->`) 직접 수정 금지
- 역할 권한 범위를 벗어난 섹션 수정 금지
- Ready for Review 게이트 5가지 조건 미충족 시 상태 변경 금지

### ✅ 필수 사항

- 매 Task/Subtask 완료 시 즉시 체크박스 업데이트
- Dev Agent Record 수시 갱신
- 외부 의존성 추가 시 사전 승인 및 라이선스/보안 검토

### 🔍 검증 명령 모음

```bash
# 전체 테스트 및 문서 검사
npm run test:unit && npm run test:integration && npm run docs:check

# 미체크 항목 찾기 (PowerShell)
Select-String -Path "docs/stories/{story}.story.md" -Pattern "- \[ \]"

# 미체크 항목 찾기 (ripgrep)
rg -n "- \[ \]" docs/stories/{story}.story.md
```

---

**참고**: 본 시각화는 [워크플로우.md](워크플로우.md)를 기반으로 작성되었습니다.
